# Query Executor Documentation
This file describes the implementation of the **Query Executor** and its three main tasks:
1. parsing the custom query language,
2. converting the custom query language into an executable database query,
3. executing the database query and obtaining database results.

## Implementation
The implementation of the **Query Executor** is located in the `query-executor/src/core`. The parsing task is handled by the this [C++ library](https://github.com/hyrise/sql-parser/) in the `SelectClauseParser` class. Subsequently, the tokens are used to convert the custom query language into an executable query.

![Database Schema](https://github.com/skrhakv/ProteInspector/blob/master/documentation/media/query-conversion.svg)

The picture assigns a color to parts of the generated executable database query. Each color denotes parser, which is responsible for generating that part of the query. The blue parts are generated by the `SelectClauseParser`. The yellow part is generated by the `MetricsParser`, specifically one of its child implementations located in the `metrics-parsers/` folder. The green part is generated by one of the `WhereClauseParser`, locate in the `where-clause-parsers/` folder. Lastly, the red part is generated by the `OderByParser` and the purple part by the one of the `LimitClauseParsers` located in the `limit-clause-parsers` folder.

To gather the shared functionality into a common modules, these classes were implemented:
* `OperatorValidator` - validates logic and math operators,
* `JsonReader` - loads data from JSON files,
* `JsonDataExtractor` - extracts important metrics data (see next section), 
* `ExpressionParser` - utilized by the `WhereClauseParser` to convert the metrics.

To execute the database query, `DbClient` class was implemented to provide the connnection with the database, run the query and return the results. 

## Supporting Data for the Conversion
The conversion process is supported by `metrics.json` file, which contains parts of the database query prepared in advance. The `JsonDataExtractor` class is responsible for extracting the appropriate data from the file.

## Connecting with the Node.js
To connect the C++ library with the Node.js, the **Node-API** addon was used. The wrapper class is declared in the `query-executor/src/query-executor-napi.hpp` file.

## Testing
The testing of the **Query Executor** is handled by the GoogleTest framework. The suite of unit tests is located in the `query-executor/src/tests` folder. To run the tests, one can simply use the `run-tests.sh` bash script.